plugins {
    id("com.android.library")
    id("kotlin-android")
    id("kotlinx-serialization")
    id("com.github.gmazzo.buildconfig") version "4.2.0"
}

ext {
    PUBLISH_GROUP_ID = 'io.appwrite'
    PUBLISH_ARTIFACT_ID = 'sdk-for-android'
    PUBLISH_VERSION = System.getenv('SDK_VERSION')
    POM_URL = 'https://github.com/appwrite/sdk-for-android'
    POM_SCM_URL = 'https://github.com/appwrite/sdk-for-android'
    POM_ISSUE_URL = 'https://github.com/appwrite/sdk-for-android/issues'
    POM_DESCRIPTION = 'Appwrite is an open-source backend as a service server that abstract and simplify complex and repetitive development tasks behind a very simple to use REST API. Appwrite aims to help you develop your apps faster and in a more secure way. Use the Android SDK to integrate your app with the Appwrite server to easily start interacting with all of Appwrite backend APIs and tools. For full API documentation and tutorials go to [https://appwrite.io/docs](https://appwrite.io/docs)'
    POM_LICENSE_URL = 'https://opensource.org/licenses/GPL-3.0'
    POM_LICENSE_NAME = "GPL-3.0"
    POM_DEVELOPER_ID = 'appwrite'
    POM_DEVELOPER_NAME = 'Appwrite Team'
    POM_DEVELOPER_EMAIL = 'team@appwrite.io'
    GITHUB_SCM_CONNECTION = 'scm:git:git://github.com/appwrite/sdk-for-android.git'
}

version PUBLISH_VERSION

android {

    defaultConfig {
        minSdkVersion(21)
        targetSdkVersion(34)
        compileSdkVersion(34)
        buildConfigField "String", "SDK_VERSION", "\"${PUBLISH_VERSION}\""
        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
        consumerProguardFiles("consumer-rules.pro")
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles(
                    getDefaultProguardFile("proguard-android-optimize.txt"),
                    "proguard-rules.pro"
            )
        }
    }
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_1_8
        targetCompatibility = JavaVersion.VERSION_1_8
    }
    kotlinOptions {
        jvmTarget = "1.8"
    }
    namespace 'io.appwrite.appwrite'
}

dependencies {
    api("org.jetbrains.kotlinx:kotlinx-coroutines-core:1.7.3")
    api("org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.3")

    implementation("com.russhwolf:multiplatform-settings-no-arg:1.1.1")
    def ktor_version = "2.3.7"
    api("io.ktor:ktor-client-core:$ktor_version")
    api("io.ktor:ktor-client-okhttp:$ktor_version")
    api("io.ktor:ktor-client-content-negotiation:$ktor_version")
    api("io.ktor:ktor-serialization-kotlinx-json:$ktor_version")
    implementation("org.jetbrains.kotlinx:atomicfu:0.23.1")

    api("org.jetbrains.kotlinx:kotlinx-serialization-json:1.6.2")

    implementation("androidx.lifecycle:lifecycle-runtime-ktx:2.6.2")
    implementation("androidx.lifecycle:lifecycle-common-java8:2.6.2")
    implementation("androidx.appcompat:appcompat:1.6.1")
    implementation("androidx.fragment:fragment-ktx:1.6.2")
    implementation("androidx.activity:activity-ktx:1.8.1")
    implementation("androidx.browser:browser:1.7.0")

    testImplementation 'junit:junit:4.13.2'
    testImplementation "androidx.test.ext:junit-ktx:1.1.5"
    testImplementation "androidx.test:core-ktx:1.5.0"
    testImplementation "org.robolectric:robolectric:4.5.1"
    testImplementation("org.jetbrains.kotlinx:kotlinx-coroutines-test:1.6.1")
}

buildConfig {
    className("MyConfig")
    useKotlinOutput()
    buildConfigField('String', 'APP_VERSION', "\"4.0.1\"")
    buildConfigField('String', 'APP_PACKAGE_NAME', "\"io.appwrite.android\"")
}

apply from: "${rootProject.projectDir}/scripts/publish-module.gradle"